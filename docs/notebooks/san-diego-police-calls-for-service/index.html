<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.30.2" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>  San Diego Police Calls For Service </title>

  
  <meta name="description" content="Maps and time ryhthms in the San Diego Police calls for service dataset"> 
  
  
  
  
  

    

  <meta name="author" content="San Diego Regional Data Library">


  <meta property="og:title" content=" San Diego Police Calls For Service" />
<meta property="og:description" content="Maps and time ryhthms in the San Diego Police calls for service dataset" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://kb.sandiegodata.org/notebooks/san-diego-police-calls-for-service/" />



<meta property="article:published_time" content="2017-11-11T21:01:56&#43;00:00"/>

<meta property="article:modified_time" content="2017-11-11T21:01:56&#43;00:00"/>











  




  
  
  
  
  

  <link rel="canonical" href="http://kb.sandiegodata.org/notebooks/san-diego-police-calls-for-service/">  

  <link rel="shortcut icon" href="/favicon.ico" >

  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">

 <link href="/css/custom.css" rel="stylesheet" type="text/css">
 <link href="/css/syntax.css" rel="stylesheet" type="text/css">
 

  <script src="/js/jquery-2.1.4.min.js" type="text/javascript">
  </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>
</head>


<body class="page-kube">
  <header> <div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">CKB</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home"><img src="/img/logo.png"></a>
    </div>
    
    <h1>San Diego Data Knowledge Base</h1>
     
    
  </div> </header>
  <main>
  <div id="main">
    <div id="hero">
      <h1>  San Diego Police Calls For Service </h1>
      <p class="hero-lead">
           Maps and time ryhthms in the San Diego Police calls for service dataset.
      </p>
      
      <p>
          <a class="button outline big" href="https://github.com/sandiegodata/kb.sandiegodata.org/blob/master/notebooks/analysis/San%20Diego%20Police%20Calls%20For%20Service.ipynb" >View Full Notebook on Github</a>
      </p>
      

    </div> 
    <div id="kube-component" class="content">
    

    

<p>Eric Busboom, 7 Nov 2017</p>

<p>In preparation for the <a href="https://www.eventbrite.com/e/exploring-san-diego-crime-data-using-python-workshop-tickets-39192959196?utm_source=eb_email&amp;utm_medium=email&amp;utm_campaign=reminder_attendees_48hour_email&amp;utm_term=eventname">SCALE and Open San Diego Crime ANalysis Presentation</a>, I downloaded the <a href="https://drive.google.com/open?id=0B-sBXvhIZi_gWHJENGd2UkhWbVk">data package for the presentation</a> and started on the analysis a bit early.</p>

<p>The presentation will use the San Diego Police 2015 calls for service, but the <a href="https://data.sandiego.gov/datasets/police-calls-for-service/">data repository has 2016 and 2017 as well</a>. The seperate files for each of the three years are converted into a data package on our repository, and I also created Metapack packages for the boundary files for beats, neighborhoods and districts. Merging in these boundary files allows for analysing crime counts by geography. Here are the packages:</p>

<ul>
<li><a href="http://data.sandiegodata.org/dataset/sandiego-gov-police_calls-2015e">SD Police Calls For Service</a></li>
<li><a href="http://data.sandiegodata.org/dataset/sandiego-gov-police_regions">SD Police Beat, District Regions</a></li>
</ul>

<p>This notebook requires the metapack package for downloading URLS, which you should be able to install, on Python 3.5 or later, with <code>pip install metapack</code></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">metapack</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="kn">as</span> <span class="nn">gpd</span> </code></pre></div>
<p>The Metapack system allows for packaging data, long with all of the metadata, and the <code>open_package</code> function can be used to load packages off the web. The the URL below is to a CSV package, which just referrs to CSV files on the web. You can get the link by to the CSV package file from the resource for <code>sandiego.gov-police_regions-1</code> in the <a href="http://data.sandiegodata.org/dataset/sandiego-gov-police_regions">SRDRL data library repository page for the package</a></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">regions</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">open_package</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;http://library.metatab.org/sandiego.gov-police_regions-1.csv&#39;</span><span class="p">)</span>
<span class="n">regions</span></code></pre></div>
<p><h1>San Diego Police Regions</h1>
<p><p>sandiego.gov-police_regions-1</p>
<p>Boundary shapes for San Diego neighborhoods, beats and divisions.</p>
<p>metapack+<a href="http://library.metatab.org/sandiego.gov-police_regions-1.csv">http://library.metatab.org/sandiego.gov-police_regions-1.csv</a></p></p>
<h2>Contacts</h2>
<p><strong>Wrangler:</strong> <a href="mailto:eric@civicknowledge.com">Eric Busboom</a> <a href="http://civicknowledge.com">Civic Knowledge</a></p>
<h2>Resources</h2>
<p><ol>
<li><p><strong>pd_beats</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv"><a href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv">http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv</a></a> Police beats</p></li>
<li><p><strong>pd_divisions</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_divisions.csv"><a href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_divisions.csv">http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_divisions.csv</a></a> Police Divisions</p></li>
<li><p><strong>pd_neighborhoods</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_neighborhoods.csv"><a href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_neighborhoods.csv">http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_neighborhoods.csv</a></a> Police Neighborhoods</p></li>
</ol></p>
</ol></p>

<p>After opening packages, we can ask the package for what resources it has, download those resources, and turn them into Pandas dataframes.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">calls_p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">open_package</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;http://library.metatab.org/sandiego.gov-police_calls-2015e-1.csv&#39;</span><span class="p">)</span>
<span class="n">calls_p</span></code></pre></div>
<p><h1>Police Calls for Service</h1>
<p><p>sandiego.gov-police_calls-2015e-1</p>
<p>Calls dispatched by the San Diego Police Departmentâ€™s communications dispatch</p>
<p>metapack+<a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1.csv</a></p></p>
<h2>Contacts</h2>
<p><strong>Wrangler:</strong> <a href="mailto:eric@civicknowledge.com">Eric Busboom</a> <a href="http://civicknowledge.com">Civic Knowledge</a></p>
<h2>Resources</h2>
<p><ol>
<li><p><strong>call_type</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/call_type.csv"><a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/call_type.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/call_type.csv</a></a> Type of call</p></li>
<li><p><strong>disposition</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/disposition.csv"><a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/disposition.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/disposition.csv</a></a> Classification</p></li>
<li><p><strong>beat</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/beat.csv"><a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/beat.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/beat.csv</a></a> San Diego PD Beat</p></li>
<li><p><strong>pd_calls</strong> - <a target="_blank" href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv"><a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv</a></a> Combined pd_calls for 2015, 2016 and YTD 2017</p></li>
</ol></p>
<h2>References</h2>
<p><ol>
<li><p><strong>pd_calls_2015</strong> - <a target="_blank" href="http://seshat.datasd.org/pd/pd_calls_for_service_2015_datasd.csv"><a href="http://seshat.datasd.org/pd/pd_calls_for_service_2015_datasd.csv">http://seshat.datasd.org/pd/pd_calls_for_service_2015_datasd.csv</a></a> Service calls for 2015</p></li>
<li><p><strong>pd_calls_2016</strong> - <a target="_blank" href="http://seshat.datasd.org/pd/pd_calls_for_service_2016_datasd.csv"><a href="http://seshat.datasd.org/pd/pd_calls_for_service_2016_datasd.csv">http://seshat.datasd.org/pd/pd_calls_for_service_2016_datasd.csv</a></a> Service calls for 2016</p></li>
<li><p><strong>pd_calls_2017_ytd</strong> - <a target="_blank" href="http://seshat.datasd.org/pd/pd_calls_for_service_2017_datasd.csv"><a href="http://seshat.datasd.org/pd/pd_calls_for_service_2017_datasd.csv">http://seshat.datasd.org/pd/pd_calls_for_service_2017_datasd.csv</a></a> Service calls for 2017, Year To Date</p></li></p>
</ol></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">calls_r</span> <span class="o">=</span> <span class="n">calls_p</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;pd_calls&#39;</span><span class="p">)</span>
<span class="n">calls_r</span></code></pre></div>
<p><h3><a name="resource-pd_calls"></a>pd_calls</h3><p><a target="_blank" href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv"><a href="http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv">http://library.metatab.org/sandiego.gov-police_calls-2015e-1/data/pd_calls.csv</a></a></p><table>
<tr><th>Header</th><th>Type</th><th>Description</th></tr><tr><td>incident_num</td><td>text</td><td>Unique Incident Identifier</td></tr>
<tr><td>date_time</td><td>datetime</td><td>Date / Time in 24 Hour Format</td></tr>
<tr><td>day</td><td>integer</td><td>Day of the week</td></tr>
<tr><td>stno</td><td>integer</td><td>Street Number of Incident, Abstracted to block level</td></tr>
<tr><td>stdir1</td><td>text</td><td>Direction of street in address</td></tr>
<tr><td>street</td><td>text</td><td>Name of Street</td></tr>
<tr><td>streettype</td><td>text</td><td>Street Type</td></tr>
<tr><td>stdir2</td><td>text</td><td>If intersecting street available, direction of that street</td></tr>
<tr><td>stname2</td><td>text</td><td>If intersecting street available, street name</td></tr>
<tr><td>sttype2</td><td>text</td><td>If intersecting street available, street type</td></tr>
<tr><td>call_type</td><td>text</td><td>Type of call</td></tr>
<tr><td>disposition</td><td>text</td><td>Classification</td></tr>
<tr><td>beat</td><td>integer</td><td>San Diego PD Beat</td></tr>
<tr><td>priority</td><td>text</td><td>Priority assigned by dispatcher</td></tr> </table></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">call_type_r</span> <span class="o">=</span> <span class="n">calls_p</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;call_type&#39;</span><span class="p">)</span>
<span class="n">call_types</span> <span class="o">=</span> <span class="n">call_type_r</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sa"></span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="sa"></span><span class="s1">&#39;call_type_desc&#39;</span><span class="p">})</span>
<span class="n">call_types</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>call_type</th>
      <th>call_type_desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>OUT OF SERV, SUBJTOCALL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10-97</td>
      <td>ARRIVE ON SCENE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1016</td>
      <td>PRISONER IN CUSTODY</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1016PT</td>
      <td>PTU (PRISONER TRANSPORT)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1016QC</td>
      <td>SHOPLIFTER/QUICK CITE</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">regions_r</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;pd_beats&#39;</span><span class="p">)</span>
<span class="n">regions_r</span></code></pre></div>
<p><h3><a name="resource-pd_beats"></a>pd_beats</h3><p><a target="_blank" href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv"><a href="http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv">http://library.metatab.org/sandiego.gov-police_regions-1/data/pd_beats.csv</a></a></p><table>
<tr><th>Header</th><th>Type</th><th>Description</th></tr><tr><td>id</td><td>integer</td><td></td></tr>
<tr><td>objectid</td><td>integer</td><td></td></tr>
<tr><td>beat</td><td>integer</td><td></td></tr>
<tr><td>div</td><td>integer</td><td></td></tr>
<tr><td>serv</td><td>integer</td><td></td></tr>
<tr><td>name</td><td>text</td><td></td></tr>
<tr><td>geometry</td><td>geometry</td><td></td></tr> </table></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># The beats.cx[:-116.8,:] bit indexes the bounding box to exclude the empty portion of the </span>
<span class="c1"># county. San Diego owns the footprint of a dam in east county, which displays as a tiny</span>
<span class="c1"># dot in the middle of empty space. </span>
<span class="c1"># Note that this isn&#39;t actually defininf the bounding box; it&#39;s cutting out far-east regions, </span>
<span class="c1"># and then GeoPandas creates the smaller bounding box that excludes them. So, the actually </span>
<span class="c1"># value in the cx indexder can vary a bit. </span>

<span class="c1"># Converting to float makes merging with the calls df ewasier, since the beat column</span>
<span class="c1"># in that df has nans. </span>

<span class="n">beats</span> <span class="o">=</span> <span class="n">regions_r</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">geo</span>
<span class="n">beats</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beats</span><span class="o">.</span><span class="n">beat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">beats</span> <span class="o">=</span> <span class="n">beats</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">[:</span><span class="o">-</span><span class="mf">116.55</span><span class="p">,:]</span>
<span class="n">beats</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span></code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_9_0.png" alt="png" /></p>

<p>There are a lot of interesting patterns in crime data when you create heat maps of two time dimensions, a visualization called a &ldquo;Rhythm Map&rdquo;. We&rsquo;ll add the time dimensions now for use later.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd_calls</span> <span class="o">=</span> <span class="n">calls_r</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">augment_time</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;dayofweek&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;weekofyear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekofyear</span>

    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;weekofdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mi">52</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekofyear</span>
    <span class="n">df</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;monthofdata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="k">assert</span> <span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">call_types</span><span class="o">.</span><span class="n">call_type</span><span class="o">.</span><span class="n">dtype</span>

<span class="n">pd_calls</span> <span class="o">=</span> <span class="n">augment_time</span><span class="p">(</span><span class="n">pd_calls</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">call_types</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;call_type&#39;</span><span class="p">)</span>

<span class="n">pd_calls</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="o">.</span><span class="n">beat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">pd_calls</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">beats</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;name&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sa"></span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="sa"></span><span class="s1">&#39;beat_name&#39;</span><span class="p">})</span></code></pre></div>
<h1 id="incident-count-maps">Incident Count Maps</h1>

<p>The following maps plot the counts of incidents, over the whole dataset, for different call types, per beat. As is familiar to anyone who has worked with San Diego area crime data, the host spots for most incident types are Pacific Beach and Downtown.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">plot_geo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">color_col</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># Need to get aspect right or it looks wacky</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">beats</span><span class="o">.</span><span class="n">total_bounds</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span> <span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x_dim</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_dim</span><span class="p">,</span><span class="n">x_dim</span><span class="o">*</span><span class="n">aspect</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="n">color_col</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;RdYlGn_r&#39;</span><span class="p">,</span>
                     <span class="n">scheme</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;fisher_jenks&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
  
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
   
    <span class="c1">#leg.set_bbox_to_anchor((0., 1.02, 1., .102))</span>
    <span class="n">leg</span><span class="o">.</span><span class="n">set_bbox_to_anchor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
        
<span class="n">_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                               <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">))</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;Incidents Per Beat, 2015 to Aug 2017&#39;</span><span class="p">)</span></code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_13_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span></code></pre></div>
<pre><code>FLAG DOWN/FIELD INITIATED         28280
REQUEST FOR TOW TRUCK             27274
NO DETAIL ACCIDENT                27070
MENTAL CASE                       25779
SPECIAL DETAIL                    25115
SELECTIVE ENFORCEMENT             25098
FOLLOW-UP BY FIELD UNIT           24348
HAZARDOUS CONDITION               23954
SLEEPER                           21584
INFORMATION FOR DISPATCHERS       21490
TRAFFIC STOP,FOR TMPOUT           19084
ALL UNITS INFORMATION-PRI 2       19056
LOUD PARTY                        17803
CAR THEFT REPORT                  16952
VEH VIOLATING 72HR PARKING RES    16155
BATTERY                           15757
RECKLESS DRIVING-ALL UNITS        15197
CRIME CASE NUMBER REQUEST         15122
FOOT PATROL/FIELD INITIATED       14955
BURGLARY REPORT                   14652
Name: call_type_desc, dtype: int64
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd_calls</span><span class="p">[</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;LOUD PARTY&#39;</span><span class="p">]</span>
                             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                             <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">))</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;LOUD PARTY calls, 2015 to Aug 2017&#34;</span><span class="p">)</span>             </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_15_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd_calls</span><span class="p">[</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;ILLEGAL PARKING&#39;</span><span class="p">]</span>
                             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                             <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">))</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span>  <span class="sa"></span><span class="s2">&#34;ILLEGAL PARKING calls, 2015 to Aug 2017&#34;</span><span class="p">)</span>  </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_16_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="p">[</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;BATTERY&#39;</span><span class="p">]</span>\
                             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>\
                             <span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                             <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">)</span>


<span class="n">plot_geo</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">_</span><span class="p">),</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;BATTERY calls, 2015 to Aug 2017&#34;</span><span class="p">)</span>  </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_17_0.png" alt="png" /></p>

<p>Sometimes, very high density areas like PB and Downtown will obscure patterns in other areas. One of the ways to handle this is to just exclude those areas. First, let&rsquo;s locate which are the highest crime area.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></code></pre></div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>incident_num</th>
      <th>id</th>
      <th>objectid</th>
      <th>div</th>
      <th>serv</th>
      <th>name</th>
      <th>geometry</th>
    </tr>
    <tr>
      <th>beat</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>521.0</th>
      <td>1278</td>
      <td>98</td>
      <td>489</td>
      <td>5</td>
      <td>520</td>
      <td>EAST VILLAGE</td>
      <td>POLYGON ((-117.1508808796175 32.71942332829821...</td>
    </tr>
    <tr>
      <th>122.0</th>
      <td>738</td>
      <td>64</td>
      <td>231</td>
      <td>1</td>
      <td>120</td>
      <td>PACIFIC BEACH</td>
      <td>POLYGON ((-117.2221709033007 32.81525925531844...</td>
    </tr>
    <tr>
      <th>524.0</th>
      <td>695</td>
      <td>93</td>
      <td>463</td>
      <td>5</td>
      <td>520</td>
      <td>CORE-COLUMBIA</td>
      <td>POLYGON ((-117.171021304813 32.71987375185346,...</td>
    </tr>
    <tr>
      <th>523.0</th>
      <td>654</td>
      <td>30</td>
      <td>83</td>
      <td>5</td>
      <td>520</td>
      <td>GASLAMP</td>
      <td>POLYGON ((-117.1610808948147 32.71569562856276...</td>
    </tr>
    <tr>
      <th>627.0</th>
      <td>565</td>
      <td>83</td>
      <td>408</td>
      <td>6</td>
      <td>620</td>
      <td>HILLCREST</td>
      <td>POLYGON ((-117.1616090022237 32.75878799862505...</td>
    </tr>
    <tr>
      <th>813.0</th>
      <td>495</td>
      <td>74</td>
      <td>352</td>
      <td>8</td>
      <td>810</td>
      <td>NORTH PARK</td>
      <td>POLYGON ((-117.1304627884029 32.7691214134209,...</td>
    </tr>
    <tr>
      <th>512.0</th>
      <td>368</td>
      <td>58</td>
      <td>203</td>
      <td>5</td>
      <td>510</td>
      <td>LOGAN HEIGHTS</td>
      <td>POLYGON ((-117.1213484238577 32.70672846114386...</td>
    </tr>
    <tr>
      <th>614.0</th>
      <td>350</td>
      <td>24</td>
      <td>64</td>
      <td>6</td>
      <td>610</td>
      <td>OCEAN BEACH</td>
      <td>POLYGON ((-117.2340495278368 32.75789474471601...</td>
    </tr>
    <tr>
      <th>511.0</th>
      <td>348</td>
      <td>21</td>
      <td>52</td>
      <td>5</td>
      <td>510</td>
      <td>None</td>
      <td>(POLYGON ((-117.2252864171211 32.7026041543147...</td>
    </tr>
    <tr>
      <th>511.0</th>
      <td>348</td>
      <td>132</td>
      <td>626</td>
      <td>5</td>
      <td>510</td>
      <td>BARRIO LOGAN</td>
      <td>POLYGON ((-117.1527936937041 32.70523801385234...</td>
    </tr>
  </tbody>
</table>
</div>

<p>Here is the map excluding the top 5 high crime areas. The excluded areas are omitted completely, shown in white.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Could also get the beats by name. </span>
<span class="n">pb_beat</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">beats</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;PACIFIC BEACH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gas_beat</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">beats</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;GASLAMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">low_crime</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
<span class="n">_lc</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">low_crime</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">_lc</span><span class="p">),</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> 
         <span class="sa"></span><span class="s2">&#34;BATTERY calls, 2015 to Aug 2017, Lower Crime Areas&#34;</span><span class="p">)</span>  </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_21_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd_calls</span><span class="p">[</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;BATTERY&#39;</span><span class="p">]</span>
                             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                             <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">))</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;BATTERY calls, 2015 to Nov 2017&#34;</span><span class="p">)</span>  </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_22_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">_</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd_calls</span><span class="p">[</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span> <span class="o">==</span> <span class="sa"></span><span class="s1">&#39;MENTAL CASE&#39;</span><span class="p">]</span>
                             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;beat&#39;</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">incident_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>\
                             <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">beats</span><span class="p">))</span>

<span class="n">plot_geo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;MENTAL CASE calls, 2015 to Aug 2017&#34;</span><span class="p">)</span>  </code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_23_0.png" alt="png" /></p>

<h1 id="rhythm-maps">Rhythm Maps</h1>

<p>By plotting two time dimensions in a heat map we can often see interesting patterns.</p>

<p>Here we&rsquo;ll look at the rhythm of parties in Pacific Beach, plotting the number of party calls as colors in a maps with an X axis of the day of the week, and a Y axis of the hour of the day. As you&rsquo;d expect, the LOUD PARTY calls are primarily on Friday and Saturday nights.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pb_beat</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">beats</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;PACIFIC BEACH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="p">[(</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;LOUD PARTY&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">beat</span> <span class="o">==</span> <span class="n">pb_beat</span><span class="p">)]</span>

<span class="n">ht</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">_</span><span class="p">,</span> 
                    <span class="n">values</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;incident_num&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;hour&#39;</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;dayofweek&#39;</span><span class="p">],</span>
                    <span class="n">aggfunc</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span></code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_25_0.png" alt="png" /></p>

<p>Looking at the hour of day versus month, there is a clear seasonal pattern, with fewer loud party calls during the winter.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pb_beat</span> <span class="o">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">beats</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;PACIFIC BEACH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="p">[(</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">call_type_desc</span><span class="o">==</span><span class="sa"></span><span class="s1">&#39;LOUD PARTY&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pd_calls</span><span class="o">.</span><span class="n">beat</span> <span class="o">==</span> <span class="n">pb_beat</span><span class="p">)]</span>



<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;LOUD PARTY Calls In Pacific Beach</span><span class="se">\n</span><span class="s2">2015 to Aug 2017</span><span class="se">\n</span><span class="s2">By Hour and Month&#34;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span></code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_27_0.png" alt="png" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">hm_beats</span> <span class="o">=</span> <span class="n">pd_calls</span><span class="p">[[</span><span class="sa"></span><span class="s1">&#39;beat_name&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="sa"></span><span class="s1">&#39;month&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">hm_beats</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">hm_beats</span> <span class="o">=</span> <span class="n">hm_beats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="sa"></span><span class="s1">&#39;beat_name&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="sa"></span><span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></code></pre></div>
<h1 id="small-multiple-rhythm-maps">Small Multiple Rhythm Maps</h1>

<p>Rhythm maps really shine when they are part of a small multiple grid, or in Seaborn terminology, a Facet Grid. These take a bit more work to setup, but they are really valuable for finding patterns.</p>

<p>Note how clearly you can see when students go back to school, and the July rowdiness in PB and MB.</p>

<p>But, the really interesting thing is that in many communities, most obviously in San Ysidro, Core-Columbia, Otay Mesa, and a few others, there are a high number of calls are 4:00 in the afternoon. Any ideas?</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Top 16 beats</span>
<span class="n">top_beats</span><span class="o">=</span> <span class="n">pd_calls</span><span class="o">.</span><span class="n">beat_name</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1"># select only the rows for the top 16 beats</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">hm_beats</span><span class="p">[</span><span class="n">hm_beats</span><span class="o">.</span><span class="n">beat_name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_beats</span><span class="p">)]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;beat_name&#34;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">facet_heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>  <span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">ht</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;hour&#34;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  

<span class="c1">#cbar_ax = g.fig.add_axes([.92, .3, .02, .4])  # Create a colorbar axes</span>

    
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">plotting_context</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">3.5</span><span class="p">):</span>   
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">map_dataframe</span><span class="p">(</span><span class="n">facet_heatmap</span><span class="p">)</span> 
    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;LOUD PARTY Calls By Month of Year, By Hour of Day, By Beat&#34;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span></code></pre></div>
<p><img src="/img/san-diego-police-calls-for-service/output_30_0.png" alt="png" /></p>


    
    </div>
    </div>
</main>
  <footer></footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
</body>

</html>
